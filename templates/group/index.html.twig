{% extends 'base.html.twig' %}

{% block navigationHeader %}
    <div class="et-hero-tabs-container">
        <a class="et-hero-tab" href="#"  data-href="{{path('group_list')}}">Liste des groupes</a>
        <a class="et-hero-tab" href="#"  data-href="{{ path('group_new') }}">Créé un groupe</a>
        <a class="et-hero-tab" href="#"  data-href="#tab-react">Trouver un groupe</a>
        <span class="et-hero-tab-slider"></span>
    </div>
{% endblock %}

{% block body %}
    <div class="container">

    </div>
    {#<div id="map"></div>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoicHJlc2xleWRldiIsImEiOiJjbDZjaWxhMWUwNTJ6M2VxaXhxYWF4Z3h6In0.LM5TC2hXXpQUzk8fHrVyKg';
        const map = new mapboxgl.Map({
            container: 'map', // container ID
            style: 'mapbox://styles/mapbox/streets-v11', // style URL
            center: [-24, 42], // starting center in [lng, lat]
            zoom: 1, // starting zoom
            projection: 'globe' // display map as a 3D globe
        });

        map.on('style.load', () => {
            map.setFog({}); // Set the default atmosphere style
        });

        // Add geolocate control to the map.
        map.addControl(
            new mapboxgl.GeolocateControl({
                positionOptions: {
                    enableHighAccuracy: true
                },
// When active the map will receive updates to the device's location as it changes.
                trackUserLocation: true,
// Draw an arrow next to the location dot to indicate which direction the device is heading.
                showUserHeading: true
            })
        );
        {% for group in groups %}
        {% if group.place %}
        new mapboxgl.Marker().setLngLat(['{{ group.place.lng }}', '{{ group.place.lat }}']).setPopup(new mapboxgl.Popup().setHTML("<h1>{{ group.place.adress }}</h1>")).addTo(map);

        {% endif %}

        {% endfor %}
    </script>#}

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        $(document).on('click','.btn-subscription', function (){
            var url = $(this).attr("data-href");
            fetch(url, {
                method: "POST",
                headers: {'Content-Type': 'application/json'},
            }).then(res => {
                console.log("Request complete! response:", res);
            });
        });
        $( document ).ready(function() {
            $(document).find('.et-hero-tab').first().trigger('click');
            $(document).on('click', '.js-load-more', function (e){
                e.stopImmediatePropagation();
                e.preventDefault();
                var url = $(this).attr("data-href");
                $.ajax({
                    type: "POST",
                    url: url,
                    success: function (data) {
                        $(document).find('.container-groups').append(data.html)
                        $(document).find('.js-load-more').attr("data-href", "{{ path('group_list_page', {'page' : 'intToChange'}) }}");
                        var newUrl = $(document).find('.js-load-more').attr("data-href").replace('intToChange', data.page);
                        $(document).find('.js-load-more').attr("data-href", newUrl);
                    }
                });
            })
        });

    </script>
{% endblock %}

